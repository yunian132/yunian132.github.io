{
    "version": "https://jsonfeed.org/version/1",
    "title": "余年的个人空间 • All posts by \"sql\" tag",
    "description": "学习笔记和随笔记录",
    "home_page_url": "https://yunian.site",
    "items": [
        {
            "id": "https://yunian.site/Note/Database/SQL%E8%AF%AD%E5%8F%A5%E9%80%9F%E6%9F%A5/",
            "url": "https://yunian.site/Note/Database/SQL%E8%AF%AD%E5%8F%A5%E9%80%9F%E6%9F%A5/",
            "title": "数据库语句速查",
            "date_published": "2024-12-23T16:00:00.000Z",
            "content_html": "<h1 id=\"信息查询\"><a class=\"anchor\" href=\"#信息查询\">#</a> 信息查询</h1>\n<h2 id=\"数据库版本查询\"><a class=\"anchor\" href=\"#数据库版本查询\">#</a> 数据库版本查询</h2>\n<p><figure class=\"highlight sql\"><figcaption><span>系统信息查询</span></figcaption><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span> <span class=\"operator\">*</span></span><br><span class=\"line\"><span class=\"keyword\">FROM</span> SUB_ENERGY.ODS_MEDIACORRESPONDENCE</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"存储过程列表\"><a class=\"anchor\" href=\"#存储过程列表\">#</a> 存储过程列表</h2>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT PROCSCHEMA, PROCNAME FROM SYSCAT.PROCEDURES</span><br><span class=\"line\">WHERE PROCSCHEMA IN (&#x27;SCHEMA_NAME1&#x27;,&#x27;SCHEMA_NAME2&#x27; )</span><br><span class=\"line\">ORDER BY PROCSCHEMA</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"表空间大小容量查询\"><a class=\"anchor\" href=\"#表空间大小容量查询\">#</a> 表空间大小容量查询</h2>\n<pre><code>SELECT substr (tbsp_name, 1, 20) AS TABLESPACE_NAME,\n\tsubstr (tbsp_content_type, 1, 10) AS TABLESPACE_TYPE,\n\tsum(tbsp_total_size_kb) / 1024 AS TOTAL_MB,\n\tsum(tbsp_used_size_kb) / 1024 AS USED_MB,\n\tsum(tbsp_free_size_kb) / 1024 AS FREE_MB,\n\ttbsp_page_size AS PAGE_SIZE\nFROM SYSIBMADM.TBSP_UTILIZATION\nGROUP BY tbsp_name, tbsp_content_type, tbsp_page_size\nORDER BY 1\n</code></pre>\n<h1 id=\"数据结构修改\"><a class=\"anchor\" href=\"#数据结构修改\">#</a> 数据结构修改</h1>\n<h2 id=\"修改数据类型\"><a class=\"anchor\" href=\"#修改数据类型\">#</a> 修改数据类型</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE schema_name.table_name ALTER column_name SET DATA TYPE DECIMAL(19, 4); </span><br></pre></td></tr></table></figure></p>\n<h2 id=\"数据分区重组\"><a class=\"anchor\" href=\"#数据分区重组\">#</a> 数据分区重组</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CALL sysproc.admin_cmd(<span class=\"string\">&#x27;reorg table SchemaName.TableName&#x27;</span>);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"修改数据库约束\"><a class=\"anchor\" href=\"#修改数据库约束\">#</a> 修改数据库约束</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE schema_name.table_name ALTER MODULE_TYPE SET NOT NULL;</span><br><span class=\"line\">REORG TABLE schema_name.table_name;</span><br><span class=\"line\">ALTER TABLE schema_name.table_name DROP PRIMARY KEY;</span><br><span class=\"line\">ALTER TABLE schema_name.table_name ADD PRIMARY KEY(SRC_SYSTEM_ID, DES_SYSTEM_ID, SRC_OBJECT_NAME, DES_OBJECT_NAME, MODULE_TYPE);</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"字段类型-长度-精度修改\"><a class=\"anchor\" href=\"#字段类型-长度-精度修改\">#</a> 字段类型、长度、精度修改</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ALTER TABLE schema_name.table_name ALTER column_name SET DATA TYPE DECIMAL(19, 4); </span><br></pre></td></tr></table></figure></p>\n<h2 id=\"表解锁语句长度-精度修改易导致锁表需要重新组织数据\"><a class=\"anchor\" href=\"#表解锁语句长度-精度修改易导致锁表需要重新组织数据\">#</a> 表解锁语句（长度、精度修改易导致锁表，需要重新组织数据）</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">CALL sysproc.admin_cmd(<span class=\"string\">&#x27;REORG TABLE schema_name.table_name&#x27;</span>);</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"日期运算\"><a class=\"anchor\" href=\"#日期运算\">#</a> 日期运算</h1>\n<h2 id=\"日期间隔天数\"><a class=\"anchor\" href=\"#日期间隔天数\">#</a> 日期间隔天数</h2>\n<p><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT DAYS(TO_DATE(&#x27;20221028&#x27;,&#x27;YYYYMMDD&#x27;)) - DAYS(TO_DATE(&#x27;20220929&#x27;,&#x27;YYYYMMDD&#x27;)) AS D_TIME </span><br><span class=\"line\">FROM SYSIBM.DUAL;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"unix时间戳转换数据库时间戳\"><a class=\"anchor\" href=\"#unix时间戳转换数据库时间戳\">#</a> UNIX 时间戳转换数据库时间戳</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">TIMESTAMP(<span class=\"string\">&#x27;1970-01-01 00:00:00.000&#x27;</span>) + (1680150600036 / 1000.0) SECONDS;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"查询上个月日期字段精度为年月\"><a class=\"anchor\" href=\"#查询上个月日期字段精度为年月\">#</a> 查询上个月 (日期字段精度为年月)</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">SELECT YEARMONTH_COLUMN FROM TABLENAME</span><br><span class=\"line\">WHERE  TABLENAME.YEARMONTH_COLUMN = (</span><br><span class=\"line\">\tSELECT YEAR (TO_DATE (<span class=\"string\">&#x27;202204&#x27;</span> + <span class=\"string\">&#x27;01&#x27;</span>, <span class=\"string\">&#x27;YYYYMMDD&#x27;</span>) - 1 MONTH)|| RIGHT (100+ MONTH (TO_DATE (<span class=\"string\">&#x27;202204&#x27;</span> || <span class=\"string\">&#x27;01&#x27;</span>, <span class=\"string\">&#x27;YYYYMMDD&#x27;</span>) - 1 MONTH),2)</span><br><span class=\"line\">\tFROM SYSIBM.DUAL</span><br><span class=\"line\">);</span><br></pre></td></tr></table></figure></p>\n<h1 id=\"授权管理\"><a class=\"anchor\" href=\"#授权管理\">#</a> 授权管理</h1>\n<h2 id=\"数据表授权\"><a class=\"anchor\" href=\"#数据表授权\">#</a> 数据表授权</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT ALTER, DELETE, INDEX, INSERT, SELECT, REFERENCES, UPDATE ON TABLE schema_name.table_name TO USER user_name WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"函数授权\"><a class=\"anchor\" href=\"#函数授权\">#</a> 函数授权</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT EXECUTE ON SPECIFIC FUNCTION schema_name.function_name TO USER user_name WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"存储过程授权\"><a class=\"anchor\" href=\"#存储过程授权\">#</a> 存储过程授权</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">GRANT EXECUTE ON PROCEDURE schema_name.procedure_name TO USER user_name WITH GRANT OPTION;</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"授权用户取消被授权用户的表级操作授权及被授权用户user_name给其他用户关联授予的相应权限\"><a class=\"anchor\" href=\"#授权用户取消被授权用户的表级操作授权及被授权用户user_name给其他用户关联授予的相应权限\">#</a> 授权用户取消被授权用户的表级操作授权，及被授权用户 user_name 给其他用户关联授予的相应权限</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REVOKE SELECT ON schema_name.table_name FROM user_name</span><br></pre></td></tr></table></figure></p>\n<h2 id=\"授权用户取消被授权用户的表级操作授权及被授权用户user_name给其他用户关联授予的相应权限-2\"><a class=\"anchor\" href=\"#授权用户取消被授权用户的表级操作授权及被授权用户user_name给其他用户关联授予的相应权限-2\">#</a> 授权用户取消被授权用户的表级操作授权，及被授权用户 user_name 给其他用户关联授予的相应权限</h2>\n<p><figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">REVOKE SELECT ON schema_name.table_name FROM user_name CASCADE</span><br></pre></td></tr></table></figure></p>\n",
            "tags": [
                "数据库",
                "开发笔记",
                "SQL"
            ]
        }
    ]
}